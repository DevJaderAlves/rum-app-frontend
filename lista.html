<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Lista de Clientes</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h1>Clientes Cadastrados</h1>
    <input type="text" id="busca" placeholder="Buscar por nome...">
    <button onclick="buscarClientes()">Buscar</button>
    <button onclick="carregarClientes()">Limpar</button>
    <table id="tabela-clientes">
      <thead>
        <tr>
          <th>Nome</th>
          <th>Email</th>
          <th>Telefone</th>
          <th>Status</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <a href="index.html" class="voltar">← Voltar ao Cadastro</a>
  </div>
<script>
const apiUrl = 'https://back-prisma-api.onrender.com';
function carregarClientes() {
  fetch(`${apiUrl}/clientes`)
    .then(res => res.json())
    .then(dados => {
      const corpo = document.querySelector('#tabela-clientes tbody');
      corpo.innerHTML = '';
      dados.forEach(cliente => {
        const linha = document.createElement('tr');
        linha.innerHTML = `
          <td>${cliente.nome}</td>
          <td>${cliente.email}</td>
          <td>${cliente.telefone}</td>
          <td>
            <span class="badge ${cliente.status}">${cliente.status}</span>
          </td>
          <td>
            <button onclick="excluirCliente(${cliente.id})">🗑️</button>
            <button onclick="alternarStatus(${cliente.id}, '${cliente.status}')">🔁</button>
            <a href="editar.html?id=${cliente.id}">
              <button>✏️</button>
            </a>
          </td>
        `;
        corpo.appendChild(linha);
      });
    });
}
function buscarClientes() {
  const termo = document.getElementById('busca').value.trim();
  if (termo === '') {
    alert('Digite um nome para buscar');
    return;
  }
  fetch(`${apiUrl}/clientes/buscar/${termo}`)
    .then(res => res.json())
    .then(dados => {
      const corpo = document.querySelector('#tabela-clientes tbody');
      corpo.innerHTML = '';
      dados.forEach(cliente => {
        const linha = document.createElement('tr');
        linha.innerHTML = `
          <td>${cliente.nome}</td>
          <td>${cliente.email}</td>
          <td>${cliente.telefone}</td>
          <td>
            <span class="badge ${cliente.status}">${cliente.status}</span>
          </td>
          <td>
            <button onclick="excluirCliente(${cliente.id})">🗑️</button>
            <button onclick="alternarStatus(${cliente.id}, '${cliente.status}')">🔁</button>
            <a href="editar.html?id=${cliente.id}">
              <button>✏️</button>
            </a>
          </td>
        `;
        corpo.appendChild(linha);
      });
    });
}
function alternarStatus(id, statusAtual) {
  const novoStatus = statusAtual === 'ativo' ? 'inativo' : 'ativo';
  fetch(`${apiUrl}/clientes/${id}/status`, {
    method: 'PATCH',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ status: novoStatus })
  }).then(res => {
    if (res.ok) {
      alert('Status atualizado!');
      location.reload();
    }
  });
}
function excluirCliente(id) {
  if (confirm("Deseja realmente excluir este cliente?")) {
    fetch(`${apiUrl}/clientes/${id}`, { method: 'DELETE' })
      .then(res => {
        if (res.ok) {
          alert('Cliente excluído!');
          location.reload();
        }
      });
  }
}
carregarClientes();
</script>
</body>
</html>


